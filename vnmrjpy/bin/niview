#!/usr/bin/python3.6

import os
import numpy as np
import nibabel as nib
from argparse import ArgumentParser
import vnmrjpy as vj

"""
Simple program to plot all slices of nifti simultaneously
"""

class niview():

    def __init__(self, nifti=None, axis=2, img=None):

        if nifti is not None:
            self.img = nib.load(nifti)
            self.data = self.img.get_fdata()
            self.axis = axis
            self.affine = self.img.affine
            print('input nifti shape: {}'.format(self.data.shape))

        elif img is not None:

            fdfrdr = vj.io.FdfReader(img)
            (hdr, data) = fdfrdr.read() 
            procpar = fdfrdr.procpar
            nwr = NiftiWriter(procpar, data)
            self.affine = nwr.aff
            self.data = data
            print('input img shape: {}'.format(self.data.shape))
                
        else:

            print('Possibly wrong input. Quitting ...')
            return
        #finding dimension with 1 length

    def interactiveplot(self):
        """Using nibabel built-in viewer"""

        v = nib.viewers.OrthoSlicer3D(self.data, affine=self.affine)
        v.show()

if __name__ == '__main__':

    parser = ArgumentParser()
    parser.add_argument('nifti')
    args = parser.parse_args()
    if str(args.nifti).endswith('.nii') or \
        str(args.nifti).endswith('.nii.gz'):
  
        nv = niview(nifti=str(args.nifti))
        nv.interactiveplot()

    elif str(args.nifti).endswith('.img') and \
        os.path.isdir(str(args.nifti)):
    
        print('Reading .fdf images in .img direcory ...')
        nv = niview(img=str(args.nifti))
        nv.interactiveplot()

    else:
        print('Wrong input: not a .nii file')
